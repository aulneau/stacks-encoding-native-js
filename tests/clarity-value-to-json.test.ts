import { ClarityTypeID, decodeClarityValue } from '../index.js';

test('decode clarity value 1 - from hex', () => {
  const val = decodeClarityValue('0x070b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000');
  expect(val).toEqual(
    {
      "hex": "0x070b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
      "repr": "(ok (list (ok (tuple (entitled-token u568008627) (to-return u0))) (ok (tuple (entitled-token u464242448) (to-return u0))) (ok (tuple (entitled-token u403396141) (to-return u0))) (ok (tuple (entitled-token u357554322) (to-return u0)))))",
      "type_id": 7,
      "value": {
        "hex": "0x0b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
        "list": [
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u568008627) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x0100000000000000000000000021db1fb3",
                  "repr": "u568008627",
                  "type_id": 1,
                  "value": "568008627"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u568008627) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u464242448) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x010000000000000000000000001babc710",
                  "repr": "u464242448",
                  "type_id": 1,
                  "value": "464242448"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u464242448) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u403396141) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x01000000000000000000000000180b562d",
                  "repr": "u403396141",
                  "type_id": 1,
                  "value": "403396141"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u403396141) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u357554322) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x01000000000000000000000000154fd892",
                  "repr": "u357554322",
                  "type_id": 1,
                  "value": "357554322"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u357554322) (to-return u0))",
              "type_id": 12
            }
          }
        ],
        "repr": "(list (ok (tuple (entitled-token u568008627) (to-return u0))) (ok (tuple (entitled-token u464242448) (to-return u0))) (ok (tuple (entitled-token u403396141) (to-return u0))) (ok (tuple (entitled-token u357554322) (to-return u0))))",
        "type_id": 11
      }
    }
  );
});

test('decode clarity value 1 - from buffer', () => {
  const val = decodeClarityValue(Buffer.from('070b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000', 'hex'));
  expect(val).toEqual(
    {
      "hex": "0x070b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
      "repr": "(ok (list (ok (tuple (entitled-token u568008627) (to-return u0))) (ok (tuple (entitled-token u464242448) (to-return u0))) (ok (tuple (entitled-token u403396141) (to-return u0))) (ok (tuple (entitled-token u357554322) (to-return u0)))))",
      "type_id": 7,
      "value": {
        "hex": "0x0b00000004070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
        "list": [
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u568008627) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x0100000000000000000000000021db1fb3",
                  "repr": "u568008627",
                  "type_id": 1,
                  "value": "568008627"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e0100000000000000000000000021db1fb309746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u568008627) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u464242448) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x010000000000000000000000001babc710",
                  "repr": "u464242448",
                  "type_id": 1,
                  "value": "464242448"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e010000000000000000000000001babc71009746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u464242448) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u403396141) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x01000000000000000000000000180b562d",
                  "repr": "u403396141",
                  "type_id": 1,
                  "value": "403396141"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e01000000000000000000000000180b562d09746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u403396141) (to-return u0))",
              "type_id": 12
            }
          },
          {
            "hex": "0x070c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
            "repr": "(ok (tuple (entitled-token u357554322) (to-return u0)))",
            "type_id": 7,
            "value": {
              "data": {
                "entitled-token": {
                  "hex": "0x01000000000000000000000000154fd892",
                  "repr": "u357554322",
                  "type_id": 1,
                  "value": "357554322"
                },
                "to-return": {
                  "hex": "0x0100000000000000000000000000000000",
                  "repr": "u0",
                  "type_id": 1,
                  "value": "0"
                }
              },
              "hex": "0x0c000000020e656e7469746c65642d746f6b656e01000000000000000000000000154fd89209746f2d72657475726e0100000000000000000000000000000000",
              "repr": "(tuple (entitled-token u357554322) (to-return u0))",
              "type_id": 12
            }
          }
        ],
        "repr": "(list (ok (tuple (entitled-token u568008627) (to-return u0))) (ok (tuple (entitled-token u464242448) (to-return u0))) (ok (tuple (entitled-token u403396141) (to-return u0))) (ok (tuple (entitled-token u357554322) (to-return u0))))",
        "type_id": 11
      }
    }
  );
});

test('decode clarity value 2 - from hex', () => {
  const val = decodeClarityValue('0x0c00000003096e616d657370616365020000000378797a0a70726f706572746965730c000000050b6c61756e636865642d61740a010000000000000000000000000000000e086c69666574696d650100000000000000000000000000000001106e616d6573706163652d696d706f7274051abf8e82623c380cd870931d48b525d5e12a4d67820e70726963652d66756e6374696f6e0c0000000504626173650100000000000000000000000000000001076275636b6574730b00000010010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000105636f6566660100000000000000000000000000000001116e6f2d766f77656c2d646973636f756e740100000000000000000000000000000001116e6f6e616c7068612d646973636f756e7401000000000000000000000000000000010b72657665616c65642d61740100000000000000000000000000000006067374617475730d000000057265616479');
  expect(val).toEqual(
    {
      "data": {
        "namespace": {
          "buffer": "0x78797a",
          "hex": "0x020000000378797a",
          "repr": "0x78797a",
          "type_id": 2
        },
        "properties": {
          "data": {
            "launched-at": {
              "hex": "0x0a010000000000000000000000000000000e",
              "repr": "(some u14)",
              "type_id": 10,
              "value": {
                "hex": "0x010000000000000000000000000000000e",
                "repr": "u14",
                "type_id": 1,
                "value": "14"
              }
            },
            "lifetime": {
              "hex": "0x0100000000000000000000000000000001",
              "repr": "u1",
              "type_id": 1,
              "value": "1"
            },
            "namespace-import": {
              "address": "ST2ZRX0K27GW0SP3GJCEMHD95TQGJMKB7G9Y0X1MH",
              "address_hash_bytes": "0xbf8e82623c380cd870931d48b525d5e12a4d6782",
              "address_version": 26,
              "hex": "0x051abf8e82623c380cd870931d48b525d5e12a4d6782",
              "repr": "'ST2ZRX0K27GW0SP3GJCEMHD95TQGJMKB7G9Y0X1MH",
              "type_id": 5
            },
            "price-function": {
              "data": {
                "base": {
                  "hex": "0x0100000000000000000000000000000001",
                  "repr": "u1",
                  "type_id": 1,
                  "value": "1"
                },
                "buckets": {
                  "hex": "0x0b000000100100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001",
                  "list": [
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    },
                    {
                      "hex": "0x0100000000000000000000000000000001",
                      "repr": "u1",
                      "type_id": 1,
                      "value": "1"
                    }
                  ],
                  "repr": "(list u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1)",
                  "type_id": 11
                },
                "coeff": {
                  "hex": "0x0100000000000000000000000000000001",
                  "repr": "u1",
                  "type_id": 1,
                  "value": "1"
                },
                "no-vowel-discount": {
                  "hex": "0x0100000000000000000000000000000001",
                  "repr": "u1",
                  "type_id": 1,
                  "value": "1"
                },
                "nonalpha-discount": {
                  "hex": "0x0100000000000000000000000000000001",
                  "repr": "u1",
                  "type_id": 1,
                  "value": "1"
                }
              },
              "hex": "0x0c0000000504626173650100000000000000000000000000000001076275636b6574730b00000010010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000105636f6566660100000000000000000000000000000001116e6f2d766f77656c2d646973636f756e740100000000000000000000000000000001116e6f6e616c7068612d646973636f756e740100000000000000000000000000000001",
              "repr": "(tuple (base u1) (buckets (list u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1)) (coeff u1) (no-vowel-discount u1) (nonalpha-discount u1))",
              "type_id": 12
            },
            "revealed-at": {
              "hex": "0x0100000000000000000000000000000006",
              "repr": "u6",
              "type_id": 1,
              "value": "6"
            }
          },
          "hex": "0x0c000000050b6c61756e636865642d61740a010000000000000000000000000000000e086c69666574696d650100000000000000000000000000000001106e616d6573706163652d696d706f7274051abf8e82623c380cd870931d48b525d5e12a4d67820e70726963652d66756e6374696f6e0c0000000504626173650100000000000000000000000000000001076275636b6574730b00000010010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000105636f6566660100000000000000000000000000000001116e6f2d766f77656c2d646973636f756e740100000000000000000000000000000001116e6f6e616c7068612d646973636f756e7401000000000000000000000000000000010b72657665616c65642d61740100000000000000000000000000000006",
          "repr": "(tuple (launched-at (some u14)) (lifetime u1) (namespace-import 'ST2ZRX0K27GW0SP3GJCEMHD95TQGJMKB7G9Y0X1MH) (price-function (tuple (base u1) (buckets (list u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1)) (coeff u1) (no-vowel-discount u1) (nonalpha-discount u1))) (revealed-at u6))",
          "type_id": 12
        },
        "status": {
          "data": "ready",
          "hex": "0x0d000000057265616479",
          "repr": "\"ready\"",
          "type_id": 13
        }
      },
      "hex": "0x0c00000003096e616d657370616365020000000378797a0a70726f706572746965730c000000050b6c61756e636865642d61740a010000000000000000000000000000000e086c69666574696d650100000000000000000000000000000001106e616d6573706163652d696d706f7274051abf8e82623c380cd870931d48b525d5e12a4d67820e70726963652d66756e6374696f6e0c0000000504626173650100000000000000000000000000000001076275636b6574730b00000010010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000101000000000000000000000000000000010100000000000000000000000000000001010000000000000000000000000000000105636f6566660100000000000000000000000000000001116e6f2d766f77656c2d646973636f756e740100000000000000000000000000000001116e6f6e616c7068612d646973636f756e7401000000000000000000000000000000010b72657665616c65642d61740100000000000000000000000000000006067374617475730d000000057265616479",
      "repr": "(tuple (namespace 0x78797a) (properties (tuple (launched-at (some u14)) (lifetime u1) (namespace-import 'ST2ZRX0K27GW0SP3GJCEMHD95TQGJMKB7G9Y0X1MH) (price-function (tuple (base u1) (buckets (list u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1 u1)) (coeff u1) (no-vowel-discount u1) (nonalpha-discount u1))) (revealed-at u6))) (status \"ready\"))",
      "type_id": 12
    }
  );
});

test('decode principal with large contract name', () => {
  const val = decodeClarityValue('0x0616982f3ec112a5f5928a5c96a914bd733793b896a52b61697031302d61726b6164696b6f2d7570646174652d74766c2d6c69717569646174696f6e2d726174696f');
  expect(val).toEqual(expect.objectContaining({
    contract_name: 'aip10-arkadiko-update-tvl-liquidation-ratio',
    type_id: ClarityTypeID.PrincipalContract
  }));
});
